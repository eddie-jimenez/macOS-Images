<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>macOS Onboarding Status</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
            background-color: transparent;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        .status-container {
            text-align: center;
            padding: 20px;
            width: 100%;
        }

        /* Loading State */
        .loading-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .spinner {
            width: 80px;
            height: 80px;
            border: 4px solid #e5e5e7;
            border-top: 4px solid #FF6900;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .status-text {
            font-size: 24px;
            font-weight: 600;
            color: #1d1d1f;
            margin: 0;
        }

        .sub-text {
            font-size: 16px;
            color: #86868b;
            margin: 5px 0 0;
        }

        .progress-dots {
            display: flex;
            gap: 8px;
            justify-content: center;
        }

        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #e5e5e7;
            animation: pulse 1.4s infinite ease-in-out both;
        }

        .dot:nth-child(1) { animation-delay: -0.32s; }
        .dot:nth-child(2) { animation-delay: -0.16s; }
        .dot:nth-child(3) { animation-delay: 0s; }

        @keyframes pulse {
            0%, 80%, 100% {
                background-color: #e5e5e7;
                transform: scale(1);
            }
            40% {
                background-color: #FF6900;
                transform: scale(1.2);
            }
        }

        /* Complete State */
        .complete-state {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .checkmark-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: #34c759;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: scaleIn 0.3s ease-out;
        }

        @keyframes scaleIn {
            0% { 
                transform: scale(0);
                opacity: 0;
            }
            100% { 
                transform: scale(1);
                opacity: 1;
            }
        }

        .checkmark {
            width: 40px;
            height: 40px;
            stroke: white;
            stroke-width: 4;
            fill: none;
            stroke-linecap: round;
            stroke-linejoin: round;
            animation: drawCheck 0.4s ease-out 0.3s forwards;
            stroke-dasharray: 50;
            stroke-dashoffset: 50;
        }

        @keyframes drawCheck {
            to {
                stroke-dashoffset: 0;
            }
        }

        .success-message {
            animation: fadeIn 0.5s ease-out 0.5s forwards;
            opacity: 0;
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }

        /* Error State */
        .error-state {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .error-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: #ff3b30;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: scaleIn 0.3s ease-out;
        }

        .error-x {
            width: 40px;
            height: 40px;
            stroke: white;
            stroke-width: 4;
            fill: none;
            stroke-linecap: round;
        }

        /* Hide everything by default when states change */
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="status-container">
        <!-- Loading State -->
        <div class="loading-state" id="loadingState">
            <div class="spinner"></div>
            <h2 class="status-text">Almost there</h2>
            <p class="sub-text">Finalizing configuration...</p>
            <div class="progress-dots">
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
            </div>
        </div>

        <!-- Complete State -->
        <div class="complete-state" id="completeState">
            <div class="checkmark-circle">
                <svg class="checkmark" viewBox="0 0 24 24">
                    <path d="M5 12l5 5L20 7"></path>
                </svg>
            </div>
            <div class="success-message">
                <h2 class="status-text">Setup Complete!</h2>
                <p class="sub-text">Your Mac is ready to use</p>
            </div>
        </div>

        <!-- Error State -->
        <div class="error-state" id="errorState">
            <div class="error-circle">
                <svg class="error-x" viewBox="0 0 24 24">
                    <path d="M6 6l12 12M6 18L18 6" stroke="currentColor"></path>
                </svg>
            </div>
            <h2 class="status-text">Setup Failed</h2>
            <p class="sub-text">Please contact IT support</p>
        </div>
    </div>

    <script>
        // Function to show complete state
        function showComplete() {
            console.log('showComplete called');
            document.getElementById('loadingState').classList.add('hidden');
            document.getElementById('errorState').classList.add('hidden');
            document.getElementById('completeState').classList.remove('hidden');
            document.getElementById('completeState').style.display = 'flex';
        }

        // Function to show error state
        function showError() {
            console.log('showError called');
            document.getElementById('loadingState').classList.add('hidden');
            document.getElementById('completeState').classList.add('hidden');
            document.getElementById('errorState').classList.remove('hidden');
            document.getElementById('errorState').style.display = 'flex';
        }

        // Function to show loading state
        function showLoading() {
            console.log('showLoading called');
            document.getElementById('completeState').classList.add('hidden');
            document.getElementById('errorState').classList.add('hidden');
            document.getElementById('loadingState').classList.remove('hidden');
            document.getElementById('loadingState').style.display = 'flex';
        }

        // Expose functions globally
        window.showComplete = showComplete;
        window.showError = showError;
        window.showLoading = showLoading;

        // Listen for messages
        window.addEventListener('message', function(e) {
            console.log('Message received:', e.data);
            if (e.data === 'complete' || e.data === 'showComplete') {
                showComplete();
            } else if (e.data === 'error' || e.data === 'showError') {
                showError();
            } else if (e.data === 'loading' || e.data === 'showLoading') {
                showLoading();
            }
        });

        // Also check for function calls in the URL hash (backup method)
        function checkHash() {
            if (window.location.hash === '#complete') {
                showComplete();
            } else if (window.location.hash === '#error') {
                showError();
            }
        }
        
        window.addEventListener('hashchange', checkHash);
        checkHash();
    </script>
</body>
</html>
